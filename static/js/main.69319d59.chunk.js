(this["webpackJsonpcoordinate-collector"]=this["webpackJsonpcoordinate-collector"]||[]).push([[0],{50:function(e,t,a){},51:function(e,t,a){},53:function(e,t,a){},60:function(e,t,a){},61:function(e,t,a){},62:function(e,t,a){},63:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a(0),r=a.n(s),o=a(21),i=a.n(o),c=(a(50),a(8)),l=a(9),d=a(11),h=a(10),j=(a(51),a(52),a(53),a(38)),u=a(68),p=a(20),b=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleDropdownChange=function(e){n.setState({val:e.target.value})},n.handleFileChange=function(e){null!=e.target.files[0]&&n.setState({uploadedMap:{url:URL.createObjectURL(e.target.files[0]),name:e.target.files[0].name}})},n.handleStart=function(){var e=n.state,t=e.uploadedMap,a=e.val;null==t?n.props.onSelect(a):n.props.onUpload(t)},n.state={val:n.props.resorts[0].id,uploadedMap:null,uploadedMapName:""},n}return Object(l.a)(a,[{key:"render",value:function(){return Object(n.jsx)("div",{id:"mapform",children:Object(n.jsx)("div",{className:"vertical-center",children:Object(n.jsx)(j.a,{className:"selectcontainer",children:Object(n.jsxs)(u.a,{children:[Object(n.jsx)(u.a.Label,{className:"form-title",children:"Welcome!"}),Object(n.jsxs)(u.a.Group,{controlId:"exampleForm.ControlSelect1",children:[Object(n.jsx)(u.a.Label,{children:"Select or upload piste map"}),Object(n.jsx)(u.a.Control,{as:"select",onChange:this.handleDropdownChange,children:this.props.resorts.map((function(e){return Object(n.jsx)("option",{value:e.id,children:e.title},e.title)}))}),Object(n.jsx)("br",{}),Object(n.jsx)(u.a.File,{onChange:this.handleFileChange,multiple:!1,accept:"image/png, image/jpeg"}),Object(n.jsx)("br",{}),this.state.uploadedMap?Object(n.jsxs)("div",{className:"image-wrapper",children:[Object(n.jsx)("img",{src:this.state.uploadedMap.url,alt:"preview"}),Object(n.jsx)("br",{}),Object(n.jsx)("br",{})]}):null]}),Object(n.jsx)(p.b,{to:"/matcher",onClick:this.handleStart,className:"btn btn-primary",children:"Start!"})]})})})})}}]),a}(r.a.Component),O=a(44),m=(a(60),a(25)),x=(a(61),a(65)),f=a(66),v=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).changeFileType=function(e){var t=e.target.value;n.setState({fileType:t})},n.download=function(e){var t;e.preventDefault();var a=n.props.points;if("json"===n.state.fileType){var s=a.map((function(e){return{id:e.id,name:e.name,shortName:e.shortName,areaId:e.areaId,pisteMapCoordinates:{x:e.x,y:e.y}}}));t=JSON.stringify(s,null,4)}else if("csv"===n.state.fileType){var r=[];r.push(["id","name","shortName","areaId","x","y"]),a.map((function(e){return r.push([e.id,e.name,e.shortName,e.areaId,e.x,e.y])})),t=n.makeCSV(r)}var o=new Blob([t]),i=URL.createObjectURL(o);n.setState({fileDownloadUrl:i},(function(){n.dofileDownload.click(),URL.revokeObjectURL(i),n.setState({fileDownloadUrl:""})}))},n.upload=function(e){e.preventDefault(),n.dofileUpload.click()},n.makeCSV=function(e){var t="";return e.forEach((function(e){e.forEach((function(e,a){var n=(void 0===e?"":e.toString()).replace(/"/g,'""');n.search(/("|,|\n)/g)>=0&&(n='"'+n+'"'),a>0&&(t+=","),t+=n})),t+="\n"})),t},n.openFile=function(e){var t=e.target.files[0],a=new FileReader;if(t instanceof Blob){var s=function(e){var t=e.target.result;try{var a=JSON.parse(t);Array.isArray(a)?n.props.loadPointData(a):a.hasOwnProperty("lifts")?n.props.loadPointData(a.lifts):a.hasOwnProperty("slopes")?n.props.loadPointData(a.slopes):a.hasOwnProperty("restaurants")?n.props.loadPointData(a.restaurants):a.hasOwnProperty("points")?n.props.loadPointData(a.points):alert("Malformed JSON data, please see Docs")}catch(e){alert(e)}};s=s.bind(Object(m.a)(n)),a.onload=s,a.readAsText(t)}};var s=n.props.title;return n.fileNames={json:String(s)+".json",csv:String(s)+".csv"},n.state={fileType:"json",fileDownloadUrl:null,resort:s},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return Object(n.jsx)("div",{id:"fileForm",children:Object(n.jsx)(j.a,{children:Object(n.jsxs)(x.a,{className:"justify-content-md-center",children:[Object(n.jsx)(f.a,{onClick:this.upload,className:"fileForm-child",children:"Upload"}),Object(n.jsx)("input",{type:"file",className:"hidden",multiple:!1,accept:".json,application/json",onChange:function(t){return e.openFile(t)},ref:function(t){return e.dofileUpload=t}}),Object(n.jsxs)(u.a.Control,{as:"select",name:"fileType",className:"fileForm-child",onChange:this.changeFileType,value:this.state.fileType,children:[Object(n.jsx)("option",{value:"csv",children:"CSV"}),Object(n.jsx)("option",{value:"json",children:"JSON"})]}),Object(n.jsx)(f.a,{onClick:this.download,className:"fileForm-child",children:"Download"}),Object(n.jsx)("a",{className:"hidden",download:this.fileNames[this.state.fileType],href:this.state.fileDownloadUrl,ref:function(t){return e.dofileDownload=t},children:"download it"})]})})})}}]),a}(r.a.Component),g=a(19),C=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).onMouseDown=function(t){t.stopPropagation(),e.props.moveDot(e.props.i)},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props,t=e.dotX,a=e.dotY,s=e.styles,r=e.dotRadius;return Object(n.jsx)("div",{className:"react-image-dot",onMouseDown:this.onMouseDown,style:Object(g.a)(Object(g.a)({},s),{},{height:2*r,width:2*r,transform:"translate(".concat(-r,", ").concat(-r,")"),top:a||0,left:t||0})})}}]),a}(r.a.Component);C.defaultProps={dotRadius:1};var D=a(27),y=(a(62),function(e){return e.show?Object(n.jsx)("div",{className:"modal-backdrop",onClick:e.clicked}):null}),w=a(39),N=a(23),S=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).clearFields=function(){n.setState({id:"",name:"",shortName:"",areaId:""})},n.onKeyPress=function(e){"Enter"===e.key&&n.props.handleSave(n.state)},n.handleInputChange=function(e){var t=e.target,a=t.value,s=t.name;n.setState(Object(D.a)({},s,a))},n.state={id:n.props.currentDot.id,name:n.props.currentDot.name,shortName:n.props.currentDot.shortName,areaId:n.props.currentDot.areaId},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=this.props.handleClose,a=window.innerWidth,s=this.props.posX>a/2?0:Math.round(.525*a);return Object(n.jsx)("div",{id:"geoCoordSelector",children:Object(n.jsxs)("div",{className:"coord-selector",children:[Object(n.jsx)(y,{show:!0,clicked:function(){return e.props.handleSave(e.state)}}),Object(n.jsxs)(N.a,{className:"modal-body",style:{top:10,left:s},children:[Object(n.jsxs)(N.a.Body,{children:[Object(n.jsx)(N.a.Title,{children:"Edit point data"}),Object(n.jsxs)(u.a,{children:[Object(n.jsxs)(u.a.Group,{as:x.a,children:[Object(n.jsx)(u.a.Label,{column:!0,children:"x"}),Object(n.jsx)(w.a,{sm:4,children:Object(n.jsx)(u.a.Control,{type:"number",defaultValue:this.props.currentDot.x,onChange:function(t){e.props.updateCurrentDot({x:t.target.valueAsNumber})}})}),Object(n.jsx)(u.a.Label,{column:!0,children:"y"}),Object(n.jsx)(w.a,{sm:4,children:Object(n.jsx)(u.a.Control,{type:"number",defaultValue:this.props.currentDot.y,onChange:function(t){e.props.updateCurrentDot({y:t.target.valueAsNumber})}})})]}),Object(n.jsxs)(u.a.Group,{as:x.a,children:[Object(n.jsx)(u.a.Label,{column:!0,children:"id"}),Object(n.jsx)(w.a,{sm:8,children:Object(n.jsx)(u.a.Control,{type:"text",placeholder:"Enter id...",name:"id",defaultValue:this.state.id,onChange:this.handleInputChange,autoFocus:!0})})]}),Object(n.jsxs)(u.a.Group,{as:x.a,children:[Object(n.jsx)(u.a.Label,{column:!0,children:"name"}),Object(n.jsx)(w.a,{sm:8,children:Object(n.jsx)(u.a.Control,{type:"text",placeholder:"Enter name...",name:"name",defaultValue:this.state.name,onChange:this.handleInputChange})})]}),Object(n.jsxs)(u.a.Group,{as:x.a,children:[Object(n.jsx)(u.a.Label,{column:!0,children:"shortName"}),Object(n.jsx)(w.a,{sm:8,children:Object(n.jsx)(u.a.Control,{type:"text",placeholder:"Enter shortName...",name:"shortName",defaultValue:this.state.shortName,onChange:this.handleInputChange})})]}),Object(n.jsxs)(u.a.Group,{as:x.a,children:[Object(n.jsx)(u.a.Label,{column:!0,children:"areaId"}),Object(n.jsx)(w.a,{sm:8,children:Object(n.jsx)(u.a.Control,{type:"text",placeholder:"Enter areaId...",name:"areaId",defaultValue:this.state.areaId,onChange:this.handleInputChange,onKeyPress:this.onKeyPress})})]})]})]}),Object(n.jsxs)(N.a.Footer,{children:[Object(n.jsx)(f.a,{variant:"secondary",onClick:t,children:"Delete"}),Object(n.jsx)(f.a,{variant:"secondary",onClick:function(){return e.props.handleSave(e.state)},children:"Close"}),Object(n.jsx)(f.a,{variant:"primary",onClick:function(){return e.props.handleSave(e.state)},children:"Save"})]})]})]})})}}]),a}(r.a.Component),k=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).onLoadPisteMap=function(e){var t=e.target;n.setState({dimensions:{renderWidth:t.offsetWidth,renderHeight:t.offsetHeight,realWidth:t.naturalWidth,realHeight:t.naturalHeight}})},n.onMouseUp=function(e){var t=e.target.getBoundingClientRect(),a=n.state,s=a.dimensions,r=a.currentDot,o=Math.round(n.renderedToRealCoord(e.clientX-t.left,s.renderWidth,s.realWidth)),i=Math.round(n.renderedToRealCoord(e.clientY-t.top,s.renderHeight,s.realHeight));if(0===Object.keys(r).length){var c={x:o,y:i};n.setState({grabbing:!1,showModal:!0,currentDot:c})}},n.updateCurrentDot=function(e){var t=n.state.currentDot;n.setState({currentDot:Object(g.a)(Object(g.a)({},t),e)})},n.moveDot=function(e){var t=n.props.dots[e];n.setState({grabbing:!0,currentDot:t,showModal:!0}),n.props.deleteDot(e)},n.resetDots=function(){n.props.resetDots()},n.renderedToRealCoord=function(e,t,a){return e/t*a},n.realToRenderedCoord=function(e,t,a){return e/a*t},n.handleShowModal=function(){n.setState({showModal:!0})},n.handleCloseModal=function(){n.setState({grabbing:!1,showModal:!1,currentDot:{}})},n.handleSave=function(e){var t=n.state.currentDot;n.setState({currentDot:Object(g.a)(Object(g.a)({},t),e)},(function(){this.props.saveDot(this.state.currentDot),this.handleCloseModal()}))},n.state={grabbing:!1,dimensions:{},currentDot:{}},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.grabbing,s=t.currentDot,r=this.state.dimensions,o=this.props,i=o.dots,c=o.backgroundImageUrl,l=o.dotRadius,d=a?"react-image-dot__grabbing":"";return Object(n.jsxs)("div",{id:"react-image-dot",children:[Object(n.jsxs)("div",{className:"react-image-dot__wrapper ".concat(d," no-select"),onMouseUp:this.onMouseUp,width:r.realWidth,height:r.realHeight,children:[Object(n.jsx)("img",{id:"pistemap-img",src:c,alt:"Piste map",width:r.realWidth,onLoad:this.onLoadPisteMap}),i.map((function(t,a){return Object(n.jsx)(C,{dotX:Math.round(e.realToRenderedCoord(t.x,r.renderWidth,r.realWidth)),dotY:Math.round(e.realToRenderedCoord(t.y,r.renderHeight,r.realHeight)),i:a,styles:{boxShadow:"0px 0px 0px 2px lime",backgroundColor:"magenta"},moveDot:e.moveDot,dotRadius:l},a)})),0===Object.keys(s).length?null:Object(n.jsx)(C,{dotX:Math.round(this.realToRenderedCoord(s.x,r.renderWidth,r.realWidth)),dotY:Math.round(this.realToRenderedCoord(s.y,r.renderHeight,r.realHeight)),i:0,styles:{boxShadow:"0px 0px 0px 2px magenta",backgroundColor:"lime"},moveDot:function(){return console.log("try to move temp dot")},dotRadius:l},-1)]}),"number of points: ",this.props.dots.length,this.state.showModal?Object(n.jsx)(S,{dimensions:r,posX:this.realToRenderedCoord(s.x,r.renderWidth,r.realWidth),handleClose:this.handleCloseModal,handleSave:this.handleSave,updateCurrentDot:this.updateCurrentDot,currentDot:this.state.currentDot}):null,this.props.resetDots&&Object(n.jsx)("button",{onClick:this.resetDots,children:"Reset"})]})}}]),a}(r.a.Component);k.defaultProps={pixelCoordinates:!0,backgroundSize:"cover"};var M=a(41);function R(e){var t=e.dots,a=e.deleteDot,s=e.resetDots;return Object(n.jsxs)("div",{className:"dotsinfo",children:[Object(n.jsx)("div",{className:"row justify-content-center",children:Object(n.jsxs)(M.a,{hover:!0,className:"dotsinfotable ",children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{children:"#"}),Object(n.jsx)("th",{children:"id"}),Object(n.jsx)("th",{children:"shortName"}),Object(n.jsx)("th",{children:"x"}),Object(n.jsx)("th",{children:"y"}),Object(n.jsx)("th",{children:"name"}),Object(n.jsx)("th",{children:"areaId"}),Object(n.jsx)("th",{children:"delete"})]})}),Object(n.jsx)("tbody",{children:t.map((function(e,t){return Object(n.jsxs)("tr",{children:[Object(n.jsxs)("td",{children:[t," "]}),Object(n.jsx)("td",{children:e.id}),Object(n.jsx)("td",{children:e.shortName}),Object(n.jsx)("td",{children:e.x}),Object(n.jsx)("td",{children:e.y}),Object(n.jsx)("td",{children:e.name}),Object(n.jsx)("td",{children:e.areaId}),Object(n.jsx)("td",{children:Object(n.jsx)(f.a,{variant:"danger",onClick:function(){return a(t)},children:"\xd7"})})]},t)}))})]})}),Object(n.jsx)(f.a,{variant:"success",onClick:function(){return s()},children:"Reset"})]})}var I=a(6),T=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).addDot=function(e){var t=n.state.dots;n.setState({dots:[].concat(Object(O.a)(t),[e]),shouldBlockNavigation:!0})},n.saveDot=function(e){var t=n.state.dots;n.deleteDot(t.length-1),n.addDot(e)},n.deleteDot=function(e){n.setState({dots:n.state.dots.filter((function(t,a){return a!==e}))})},n.resetDots=function(){n.setState({dots:n.initialDots})},n.handleResize=function(){n.setState({windowWidth:.98*window.innerWidth})},n.loadPointData=function(e){var t=e.map((function(e){return{id:e.id,name:e.name,shortName:e.shortName,areaId:e.areaId,x:e.pisteMapCoordinates?e.pisteMapCoordinates.x:0,y:e.pisteMapCoordinates?e.pisteMapCoordinates.y:0}}));n.initialDots=t,n.setState({dots:t})},n.initialDots=[],n.state={title:n.props.resort.title,src:n.props.resort.src,dots:n.initialDots,windowWidth:.98*window.innerWidth,shouldBlockNavigation:!1},n}return Object(l.a)(a,[{key:"componentDidUpdate",value:function(){this.state.shouldBlockNavigation?window.onbeforeunload=function(){return!0}:window.onbeforeunload=void 0}},{key:"renderedToRealCoord",value:function(e,t,a){return e/t*a}},{key:"realToRenderedCoord",value:function(e,t,a){return e/a*t}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize)}},{key:"render",value:function(){var e=this.state,t=e.dots,a=e.src;return Object(n.jsxs)("div",{id:"matcher",children:[Object(n.jsx)(I.a,{when:this.state.shouldBlockNavigation,message:"You have unsaved changes, are you sure you want to leave?"}),Object(n.jsx)(k,{backgroundImageUrl:a,onLoadMap:this.onLoadPisteMap,dots:t,deleteDot:this.deleteDot,saveDot:this.saveDot,addDot:this.addDot,dotRadius:10}),Object(n.jsxs)("div",{className:"bottom-toolbox",children:[this.props.resort.title,Object(n.jsx)(v,{imgSrc:this.state.src,title:this.state.title,points:this.state.dots,loadPointData:this.loadPointData}),Object(n.jsx)(R,{dots:this.state.dots,deleteDot:this.deleteDot,resetDots:this.resetDots})]})]})}}]),a}(r.a.Component),L=[{id:0,src:"./assets/are.png",title:"\xc5re"},{id:1,src:"./assets/bjornen.png",title:"\xc5re Bj\xf6rnen"},{id:2,src:"./assets/duved.png",title:"Duved"},{id:3,src:"./assets/bjornrike.png",title:"Bj\xf6rnrike"},{id:4,src:"./assets/vemdalsskalet.png",title:"Vemdalsskalet"},{id:5,src:"./assets/hemsedal.png",title:"Hemsedal"},{id:6,src:"./assets/salen-lindvallen.png",title:"Lindvallen"},{id:7,src:"./assets/salen-hogfjallet.png",title:"H\xf6gfj\xe4llet"},{id:8,src:"./assets/salen-hundfjallet.png",title:"Hundfj\xe4llet"}];var P=function(e){return Object(n.jsx)("div",{id:"docs",children:Object(n.jsxs)("div",{className:"page-content",children:[Object(n.jsx)("h1",{children:"Documentation"}),Object(n.jsxs)("ul",{children:[Object(n.jsx)("li",{children:"Start by selecting a piste map from the drop down field or uploading a map using the file upload button"}),Object(n.jsxs)("li",{children:["Clicking ",Object(n.jsx)("b",{children:"Start"})," will take you to the ",Object(n.jsx)("b",{children:"matching view"}),". Here, you can click on the map to add a new point."]}),Object(n.jsx)("li",{children:"When a new point is added, the input modal is shown. Here you can make adjustments to the (x, y) coordinate, the id, name, shortName, and areaId. Click on save to save the point."}),Object(n.jsxs)("li",{children:["You can also upload an existing JSON file in the ",Object(n.jsx)("b",{children:"matching view"}),". This will load the data in the file and render the points. You can make changes, and then download the updated version using the ",Object(n.jsx)("b",{children:"Download"})," button."]})]}),Object(n.jsx)("br",{}),Object(n.jsxs)(j.a,{children:[Object(n.jsx)(x.a,{children:Object(n.jsx)("h2",{children:"File structure"})}),Object(n.jsx)(x.a,{children:Object(n.jsx)("div",{className:"json-snippet",children:Object(n.jsx)("pre",{children:JSON.stringify({points:[{id:"193",name:"Adam",shortName:"1",areaId:"lindvallen",pisteMapCoordinates:{x:145,y:537}},{id:"194",name:"Pernilla",shortName:"2",areaId:"lindvallen",pisteMapCoordinates:{x:281,y:535}}]},null,2)})})})]})]})})};var W=function(e){return Object(n.jsx)("div",{id:"about",children:Object(n.jsxs)("div",{className:"page-content",children:[Object(n.jsx)("h1",{children:"About"}),Object(n.jsxs)("p",{children:[Object(n.jsx)("b",{children:"Created by:"})," Lou-Lou Pei ",Object(n.jsx)("br",{}),Object(n.jsx)("b",{children:"Why:"})," To aid in the coordinate collection process of piste maps. ",Object(n.jsx)("br",{}),Object(n.jsx)("a",{href:"https://github.com/ellpei/coordinate-collector/issues",children:"Submit an issue"})]})]})})},U=a(67),F=a(69),H=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).setResort=function(e,t){n.setState({resortObject:L[e],useGeoCoords:t})},n.uploadMap=function(e,t){var a=e.name,s=a.substr(0,a.lastIndexOf("."));n.setState({resortObject:{src:e.url,title:s},useGeoCoords:t})},n.state={resortObject:null,useGeoCoords:!0},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return Object(n.jsx)("div",{className:"App",children:Object(n.jsxs)(p.a,{basename:"/",children:[Object(n.jsxs)(U.a,{className:"navbar",bg:"light",variant:"light",children:[Object(n.jsx)(p.b,{className:"navbar-brand",to:"/",children:Object(n.jsx)("div",{className:"header",children:Object(n.jsx)("h1",{children:"Coordinate Collector"})})}),Object(n.jsxs)(F.a,{className:"mr-auto",children:[Object(n.jsx)(p.b,{className:"nav-link",to:"/docs",children:"Docs"}),Object(n.jsx)(p.b,{className:"nav-link",to:"/about",children:"About"})]}),this.state.resortObject?Object(n.jsx)(U.a.Text,{children:this.state.resortObject.title}):null]}),Object(n.jsxs)(I.e,{children:[Object(n.jsx)(I.c,{exact:!0,path:"/",children:Object(n.jsx)(b,{resorts:L,onSelect:this.setResort,onUpload:this.uploadMap})}),Object(n.jsx)(I.c,{path:"/docs",children:Object(n.jsx)(P,{})}),Object(n.jsx)(I.c,{path:"/about",children:Object(n.jsx)(W,{})}),Object(n.jsx)(I.c,{path:"/matcher",children:e.state.resortObject?Object(n.jsx)(T,{resort:e.state.resortObject}):Object(n.jsx)(I.b,{to:{pathname:"/",state:{from:e.props.location}}})})]})]})})}}]),a}(r.a.Component),B=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,70)).then((function(t){var a=t.getCLS,n=t.getFID,s=t.getFCP,r=t.getLCP,o=t.getTTFB;a(e),n(e),s(e),r(e),o(e)}))};i.a.render(Object(n.jsx)(H,{}),document.getElementById("root")),B()}},[[63,1,2]]]);
//# sourceMappingURL=main.69319d59.chunk.js.map